{"ast":null,"code":"var _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n}\n\nimport * as utils from './utils.js';\nimport baseLogger from './logger.js';\nimport EventEmitter from './EventEmitter.js';\n\nfunction remove(arr, what) {\n  var found = arr.indexOf(what);\n\n  while (found !== -1) {\n    arr.splice(found, 1);\n    found = arr.indexOf(what);\n  }\n}\n\nvar Connector = function (_EventEmitter) {\n  _inherits(Connector, _EventEmitter);\n\n  function Connector(backend, store, services) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Connector);\n\n    var _this = _possibleConstructorReturn(this, _EventEmitter.call(this));\n\n    _this.backend = backend;\n    _this.store = store;\n    _this.languageUtils = services.languageUtils;\n    _this.options = options;\n    _this.logger = baseLogger.create('backendConnector');\n    _this.state = {};\n    _this.queue = [];\n\n    if (_this.backend && _this.backend.init) {\n      _this.backend.init(services, options.backend, options);\n    }\n\n    return _this;\n  }\n\n  Connector.prototype.queueLoad = function queueLoad(languages, namespaces, callback) {\n    var _this2 = this; // find what needs to be loaded\n\n\n    var toLoad = [];\n    var pending = [];\n    var toLoadLanguages = [];\n    var toLoadNamespaces = [];\n    languages.forEach(function (lng) {\n      var hasAllNamespaces = true;\n      namespaces.forEach(function (ns) {\n        var name = lng + '|' + ns;\n\n        if (_this2.store.hasResourceBundle(lng, ns)) {\n          _this2.state[name] = 2; // loaded\n        } else if (_this2.state[name] < 0) {// nothing to do for err\n        } else if (_this2.state[name] === 1) {\n          if (pending.indexOf(name) < 0) pending.push(name);\n        } else {\n          _this2.state[name] = 1; // pending\n\n          hasAllNamespaces = false;\n          if (pending.indexOf(name) < 0) pending.push(name);\n          if (toLoad.indexOf(name) < 0) toLoad.push(name);\n          if (toLoadNamespaces.indexOf(ns) < 0) toLoadNamespaces.push(ns);\n        }\n      });\n      if (!hasAllNamespaces) toLoadLanguages.push(lng);\n    });\n\n    if (toLoad.length || pending.length) {\n      this.queue.push({\n        pending: pending,\n        loaded: {},\n        errors: [],\n        callback: callback\n      });\n    }\n\n    return {\n      toLoad: toLoad,\n      pending: pending,\n      toLoadLanguages: toLoadLanguages,\n      toLoadNamespaces: toLoadNamespaces\n    };\n  };\n\n  Connector.prototype.loaded = function loaded(name, err, data) {\n    var _this3 = this;\n\n    var _name$split = name.split('|'),\n        _name$split2 = _slicedToArray(_name$split, 2),\n        lng = _name$split2[0],\n        ns = _name$split2[1];\n\n    if (err) this.emit('failedLoading', lng, ns, err);\n\n    if (data) {\n      this.store.addResourceBundle(lng, ns, data);\n    } // set loaded\n\n\n    this.state[name] = err ? -1 : 2; // callback if ready\n\n    this.queue.forEach(function (q) {\n      utils.pushPath(q.loaded, [lng], ns);\n      remove(q.pending, name);\n      if (err) q.errors.push(err);\n\n      if (q.pending.length === 0 && !q.done) {\n        _this3.emit('loaded', q.loaded);\n        /* eslint no-param-reassign: 0 */\n\n\n        q.done = true;\n\n        if (q.errors.length) {\n          q.callback(q.errors);\n        } else {\n          q.callback();\n        }\n      }\n    }); // remove done load requests\n\n    this.queue = this.queue.filter(function (q) {\n      return !q.done;\n    });\n  };\n\n  Connector.prototype.read = function read(lng, ns, fcName) {\n    var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n    var _this4 = this;\n\n    var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n    var callback = arguments[5];\n    if (!lng.length) return callback(null, {}); // noting to load\n\n    return this.backend[fcName](lng, ns, function (err, data) {\n      if (err && data\n      /* = retryFlag */\n      && tried < 5) {\n        setTimeout(function () {\n          _this4.read.call(_this4, lng, ns, fcName, tried + 1, wait * 2, callback);\n        }, wait);\n        return;\n      }\n\n      callback(err, data);\n    });\n  };\n  /* eslint consistent-return: 0 */\n\n\n  Connector.prototype.load = function load(languages, namespaces, callback) {\n    var _this5 = this;\n\n    if (!this.backend) {\n      this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n      return callback && callback();\n    }\n\n    var options = _extends({}, this.backend.options, this.options.backend);\n\n    if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n    if (typeof namespaces === 'string') namespaces = [namespaces];\n    var toLoad = this.queueLoad(languages, namespaces, callback);\n\n    if (!toLoad.toLoad.length) {\n      if (!toLoad.pending.length) callback(); // nothing to load and no pendings...callback now\n\n      return null; // pendings will trigger callback\n    } // load with multi-load\n\n\n    if (options.allowMultiLoading && this.backend.readMulti) {\n      this.read(toLoad.toLoadLanguages, toLoad.toLoadNamespaces, 'readMulti', null, null, function (err, data) {\n        if (err) _this5.logger.warn('loading namespaces ' + toLoad.toLoadNamespaces.join(', ') + ' for languages ' + toLoad.toLoadLanguages.join(', ') + ' via multiloading failed', err);\n        if (!err && data) _this5.logger.log('successfully loaded namespaces ' + toLoad.toLoadNamespaces.join(', ') + ' for languages ' + toLoad.toLoadLanguages.join(', ') + ' via multiloading', data);\n        toLoad.toLoad.forEach(function (name) {\n          var _name$split3 = name.split('|'),\n              _name$split4 = _slicedToArray(_name$split3, 2),\n              l = _name$split4[0],\n              n = _name$split4[1];\n\n          var bundle = utils.getPath(data, [l, n]);\n\n          if (bundle) {\n            _this5.loaded(name, err, bundle);\n          } else {\n            var error = 'loading namespace ' + n + ' for language ' + l + ' via multiloading failed';\n\n            _this5.loaded(name, error);\n\n            _this5.logger.error(error);\n          }\n        });\n      });\n    } else {\n      toLoad.toLoad.forEach(function (name) {\n        _this5.loadOne(name);\n      });\n    }\n  };\n\n  Connector.prototype.reload = function reload(languages, namespaces) {\n    var _this6 = this;\n\n    if (!this.backend) {\n      this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n    }\n\n    var options = _extends({}, this.backend.options, this.options.backend);\n\n    if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n    if (typeof namespaces === 'string') namespaces = [namespaces]; // load with multi-load\n\n    if (options.allowMultiLoading && this.backend.readMulti) {\n      this.read(languages, namespaces, 'readMulti', null, null, function (err, data) {\n        if (err) _this6.logger.warn('reloading namespaces ' + namespaces.join(', ') + ' for languages ' + languages.join(', ') + ' via multiloading failed', err);\n        if (!err && data) _this6.logger.log('successfully reloaded namespaces ' + namespaces.join(', ') + ' for languages ' + languages.join(', ') + ' via multiloading', data);\n        languages.forEach(function (l) {\n          namespaces.forEach(function (n) {\n            var bundle = utils.getPath(data, [l, n]);\n\n            if (bundle) {\n              _this6.loaded(l + '|' + n, err, bundle);\n            } else {\n              var error = 'reloading namespace ' + n + ' for language ' + l + ' via multiloading failed';\n\n              _this6.loaded(l + '|' + n, error);\n\n              _this6.logger.error(error);\n            }\n          });\n        });\n      });\n    } else {\n      languages.forEach(function (l) {\n        namespaces.forEach(function (n) {\n          _this6.loadOne(l + '|' + n, 're');\n        });\n      });\n    }\n  };\n\n  Connector.prototype.loadOne = function loadOne(name) {\n    var _this7 = this;\n\n    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n    var _name$split5 = name.split('|'),\n        _name$split6 = _slicedToArray(_name$split5, 2),\n        lng = _name$split6[0],\n        ns = _name$split6[1];\n\n    this.read(lng, ns, 'read', null, null, function (err, data) {\n      if (err) _this7.logger.warn(prefix + 'loading namespace ' + ns + ' for language ' + lng + ' failed', err);\n      if (!err && data) _this7.logger.log(prefix + 'loaded namespace ' + ns + ' for language ' + lng, data);\n\n      _this7.loaded(name, err, data);\n    });\n  };\n\n  Connector.prototype.saveMissing = function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n    var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n    if (this.backend && this.backend.create) {\n      this.backend.create(languages, namespace, key, fallbackValue, null\n      /* unused callback */\n      , _extends({}, options, {\n        isUpdate: isUpdate\n      }));\n    } // write to store to avoid resending\n\n\n    if (!languages || !languages[0]) return;\n    this.store.addResource(languages[0], namespace, key, fallbackValue);\n  };\n\n  return Connector;\n}(EventEmitter);\n\nexport default Connector;","map":{"version":3,"sources":["/Users/plsingh/Downloads/archive-19Sep-Sunday/node_modules/i18next/dist/es/BackendConnector.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","value","err","Array","isArray","TypeError","_defaults","obj","defaults","keys","getOwnPropertyNames","getOwnPropertyDescriptor","configurable","defineProperty","_classCallCheck","instance","Constructor","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","enumerable","writable","setPrototypeOf","utils","baseLogger","EventEmitter","remove","what","found","indexOf","splice","Connector","_EventEmitter","backend","store","services","options","_this","languageUtils","logger","state","queue","init","queueLoad","languages","namespaces","callback","_this2","toLoad","pending","toLoadLanguages","toLoadNamespaces","forEach","lng","hasAllNamespaces","ns","name","hasResourceBundle","loaded","errors","data","_this3","_name$split","split","_name$split2","emit","addResourceBundle","q","pushPath","filter","read","fcName","tried","_this4","wait","setTimeout","load","_this5","warn","toResolveHierarchy","allowMultiLoading","readMulti","join","log","_name$split3","_name$split4","l","n","bundle","getPath","error","loadOne","reload","_this6","_this7","prefix","_name$split5","_name$split6","saveMissing","namespace","fallbackValue","isUpdate","addResource"],"mappings":"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","sourcesContent":["var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nfunction _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }\n\nimport * as utils from './utils.js';\nimport baseLogger from './logger.js';\nimport EventEmitter from './EventEmitter.js';\n\nfunction remove(arr, what) {\n  var found = arr.indexOf(what);\n\n  while (found !== -1) {\n    arr.splice(found, 1);\n    found = arr.indexOf(what);\n  }\n}\n\nvar Connector = function (_EventEmitter) {\n  _inherits(Connector, _EventEmitter);\n\n  function Connector(backend, store, services) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Connector);\n\n    var _this = _possibleConstructorReturn(this, _EventEmitter.call(this));\n\n    _this.backend = backend;\n    _this.store = store;\n    _this.languageUtils = services.languageUtils;\n    _this.options = options;\n    _this.logger = baseLogger.create('backendConnector');\n\n    _this.state = {};\n    _this.queue = [];\n\n    if (_this.backend && _this.backend.init) {\n      _this.backend.init(services, options.backend, options);\n    }\n    return _this;\n  }\n\n  Connector.prototype.queueLoad = function queueLoad(languages, namespaces, callback) {\n    var _this2 = this;\n\n    // find what needs to be loaded\n    var toLoad = [];\n    var pending = [];\n    var toLoadLanguages = [];\n    var toLoadNamespaces = [];\n\n    languages.forEach(function (lng) {\n      var hasAllNamespaces = true;\n\n      namespaces.forEach(function (ns) {\n        var name = lng + '|' + ns;\n\n        if (_this2.store.hasResourceBundle(lng, ns)) {\n          _this2.state[name] = 2; // loaded\n        } else if (_this2.state[name] < 0) {\n          // nothing to do for err\n        } else if (_this2.state[name] === 1) {\n          if (pending.indexOf(name) < 0) pending.push(name);\n        } else {\n          _this2.state[name] = 1; // pending\n\n          hasAllNamespaces = false;\n\n          if (pending.indexOf(name) < 0) pending.push(name);\n          if (toLoad.indexOf(name) < 0) toLoad.push(name);\n          if (toLoadNamespaces.indexOf(ns) < 0) toLoadNamespaces.push(ns);\n        }\n      });\n\n      if (!hasAllNamespaces) toLoadLanguages.push(lng);\n    });\n\n    if (toLoad.length || pending.length) {\n      this.queue.push({\n        pending: pending,\n        loaded: {},\n        errors: [],\n        callback: callback\n      });\n    }\n\n    return {\n      toLoad: toLoad,\n      pending: pending,\n      toLoadLanguages: toLoadLanguages,\n      toLoadNamespaces: toLoadNamespaces\n    };\n  };\n\n  Connector.prototype.loaded = function loaded(name, err, data) {\n    var _this3 = this;\n\n    var _name$split = name.split('|'),\n        _name$split2 = _slicedToArray(_name$split, 2),\n        lng = _name$split2[0],\n        ns = _name$split2[1];\n\n    if (err) this.emit('failedLoading', lng, ns, err);\n\n    if (data) {\n      this.store.addResourceBundle(lng, ns, data);\n    }\n\n    // set loaded\n    this.state[name] = err ? -1 : 2;\n\n    // callback if ready\n    this.queue.forEach(function (q) {\n      utils.pushPath(q.loaded, [lng], ns);\n      remove(q.pending, name);\n\n      if (err) q.errors.push(err);\n\n      if (q.pending.length === 0 && !q.done) {\n        _this3.emit('loaded', q.loaded);\n        /* eslint no-param-reassign: 0 */\n        q.done = true;\n        if (q.errors.length) {\n          q.callback(q.errors);\n        } else {\n          q.callback();\n        }\n      }\n    });\n\n    // remove done load requests\n    this.queue = this.queue.filter(function (q) {\n      return !q.done;\n    });\n  };\n\n  Connector.prototype.read = function read(lng, ns, fcName) {\n    var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n    var _this4 = this;\n\n    var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n    var callback = arguments[5];\n\n    if (!lng.length) return callback(null, {}); // noting to load\n\n    return this.backend[fcName](lng, ns, function (err, data) {\n      if (err && data /* = retryFlag */ && tried < 5) {\n        setTimeout(function () {\n          _this4.read.call(_this4, lng, ns, fcName, tried + 1, wait * 2, callback);\n        }, wait);\n        return;\n      }\n      callback(err, data);\n    });\n  };\n\n  /* eslint consistent-return: 0 */\n\n\n  Connector.prototype.load = function load(languages, namespaces, callback) {\n    var _this5 = this;\n\n    if (!this.backend) {\n      this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n      return callback && callback();\n    }\n    var options = _extends({}, this.backend.options, this.options.backend);\n\n    if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n    if (typeof namespaces === 'string') namespaces = [namespaces];\n\n    var toLoad = this.queueLoad(languages, namespaces, callback);\n    if (!toLoad.toLoad.length) {\n      if (!toLoad.pending.length) callback(); // nothing to load and no pendings...callback now\n      return null; // pendings will trigger callback\n    }\n\n    // load with multi-load\n    if (options.allowMultiLoading && this.backend.readMulti) {\n      this.read(toLoad.toLoadLanguages, toLoad.toLoadNamespaces, 'readMulti', null, null, function (err, data) {\n        if (err) _this5.logger.warn('loading namespaces ' + toLoad.toLoadNamespaces.join(', ') + ' for languages ' + toLoad.toLoadLanguages.join(', ') + ' via multiloading failed', err);\n        if (!err && data) _this5.logger.log('successfully loaded namespaces ' + toLoad.toLoadNamespaces.join(', ') + ' for languages ' + toLoad.toLoadLanguages.join(', ') + ' via multiloading', data);\n\n        toLoad.toLoad.forEach(function (name) {\n          var _name$split3 = name.split('|'),\n              _name$split4 = _slicedToArray(_name$split3, 2),\n              l = _name$split4[0],\n              n = _name$split4[1];\n\n          var bundle = utils.getPath(data, [l, n]);\n          if (bundle) {\n            _this5.loaded(name, err, bundle);\n          } else {\n            var error = 'loading namespace ' + n + ' for language ' + l + ' via multiloading failed';\n            _this5.loaded(name, error);\n            _this5.logger.error(error);\n          }\n        });\n      });\n    } else {\n      toLoad.toLoad.forEach(function (name) {\n        _this5.loadOne(name);\n      });\n    }\n  };\n\n  Connector.prototype.reload = function reload(languages, namespaces) {\n    var _this6 = this;\n\n    if (!this.backend) {\n      this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n    }\n    var options = _extends({}, this.backend.options, this.options.backend);\n\n    if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n    if (typeof namespaces === 'string') namespaces = [namespaces];\n\n    // load with multi-load\n    if (options.allowMultiLoading && this.backend.readMulti) {\n      this.read(languages, namespaces, 'readMulti', null, null, function (err, data) {\n        if (err) _this6.logger.warn('reloading namespaces ' + namespaces.join(', ') + ' for languages ' + languages.join(', ') + ' via multiloading failed', err);\n        if (!err && data) _this6.logger.log('successfully reloaded namespaces ' + namespaces.join(', ') + ' for languages ' + languages.join(', ') + ' via multiloading', data);\n\n        languages.forEach(function (l) {\n          namespaces.forEach(function (n) {\n            var bundle = utils.getPath(data, [l, n]);\n            if (bundle) {\n              _this6.loaded(l + '|' + n, err, bundle);\n            } else {\n              var error = 'reloading namespace ' + n + ' for language ' + l + ' via multiloading failed';\n              _this6.loaded(l + '|' + n, error);\n              _this6.logger.error(error);\n            }\n          });\n        });\n      });\n    } else {\n      languages.forEach(function (l) {\n        namespaces.forEach(function (n) {\n          _this6.loadOne(l + '|' + n, 're');\n        });\n      });\n    }\n  };\n\n  Connector.prototype.loadOne = function loadOne(name) {\n    var _this7 = this;\n\n    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n    var _name$split5 = name.split('|'),\n        _name$split6 = _slicedToArray(_name$split5, 2),\n        lng = _name$split6[0],\n        ns = _name$split6[1];\n\n    this.read(lng, ns, 'read', null, null, function (err, data) {\n      if (err) _this7.logger.warn(prefix + 'loading namespace ' + ns + ' for language ' + lng + ' failed', err);\n      if (!err && data) _this7.logger.log(prefix + 'loaded namespace ' + ns + ' for language ' + lng, data);\n\n      _this7.loaded(name, err, data);\n    });\n  };\n\n  Connector.prototype.saveMissing = function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n    var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n    if (this.backend && this.backend.create) {\n      this.backend.create(languages, namespace, key, fallbackValue, null /* unused callback */, _extends({}, options, { isUpdate: isUpdate }));\n    }\n\n    // write to store to avoid resending\n    if (!languages || !languages[0]) return;\n    this.store.addResource(languages[0], namespace, key, fallbackValue);\n  };\n\n  return Connector;\n}(EventEmitter);\n\nexport default Connector;"]},"metadata":{},"sourceType":"module"}